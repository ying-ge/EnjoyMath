<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•ç»“æœ - è‡ªé€‚åº”æ•°å­¦æ°´å¹³æµ‹è¯•</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@300;400;500&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        .result-title {
            text-align: center;
            font-size: 2rem;
            font-weight: 400;
            color: #34495E;
            margin-bottom: 32px;
        }
        
        .result-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .summary-item {
            background: #FAFAFA;
            padding: 24px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #E0E0E0;
        }
        
        .summary-label {
            font-size: 0.875rem;
            color: #666666;
            margin-bottom: 12px;
        }
        
        .summary-value {
            font-size: 2.5rem;
            font-weight: 500;
            color: #34495E;
            margin-bottom: 8px;
        }
        
        .summary-detail {
            font-size: 0.875rem;
            color: #666666;
        }
        
        .section {
            margin: 32px 0;
        }
        
        .section h2 {
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 2px solid #E0E0E0;
        }
        
        .semester-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .semester-item {
            background: #FAFAFA;
            padding: 16px;
            border-radius: 6px;
            border-left: 4px solid #95A5A6;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .semester-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .semester-name {
            font-weight: 500;
            color: #34495E;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }
        
        .semester-progress {
            width: 100%;
            height: 6px;
            background: #E0E0E0;
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .semester-progress-bar {
            height: 100%;
            background: #95A5A6;
            transition: width 0.3s;
        }
        
        .semester-stats {
            font-size: 0.75rem;
            color: #666666;
        }
        
        .result-actions {
            text-align: center;
            margin-top: 40px;
        }
        
        .result-actions .button {
            margin: 0 8px;
        }
        
        /* å»ºè®®æ ·å¼ */
        .suggestions-content {
            margin-top: 20px;
        }
        
        .advice-card {
            background: #FAFAFA;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            border-left: 4px solid #95A5A6;
        }
        
        .advice-card.weak-point {
            border-left-color: #E74C3C;
            background: #FFF5F5;
        }
        
        .advice-card.overall-advice {
            border-left-color: #34495E;
            background: #F8F9FA;
        }
        
        .advice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .advice-header h4 {
            margin: 0;
            color: #34495E;
            font-size: 1.125rem;
        }
        
        .mastery-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .mastery-low {
            background: #FADBD8;
            color: #C0392B;
        }
        
        .mastery-high {
            background: #D5F4E6;
            color: #27AE60;
        }
        
        .advice-content h3 {
            margin: 0 0 12px 0;
            color: #34495E;
            font-size: 1rem;
        }
        
        .advice-content p {
            margin: 8px 0;
            line-height: 1.6;
            color: #555555;
        }
        
        .guidance-focus,
        .guidance-method,
        .guidance-tips {
            margin: 16px 0;
        }
        
        .guidance-focus ul,
        .guidance-tips ul {
            margin: 8px 0;
            padding-left: 24px;
        }
        
        .guidance-focus li,
        .guidance-tips li {
            margin: 4px 0;
            color: #666666;
        }
        
        .practice-questions {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #E0E0E0;
        }
        
        .question-links {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        
        .question-link {
            display: inline-block;
            padding: 6px 12px;
            background: #34495E;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.875rem;
            transition: background 0.2s;
        }
        
        .question-link:hover {
            background: #2C3E50;
        }
        
        /* æ¨èç»ƒä¹ é¢˜æ ·å¼ */
        .practice-questions-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 16px;
        }
        
        .practice-question-item {
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 8px;
            padding: 20px;
            transition: box-shadow 0.2s;
        }
        
        .practice-question-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .practice-question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #E0E0E0;
        }
        
        .practice-question-id {
            font-weight: 500;
            color: #34495E;
        }
        
        .practice-question-meta {
            display: flex;
            gap: 12px;
            font-size: 0.875rem;
            color: #666666;
        }
        
        .practice-question-content {
            font-size: 1.125rem;
            margin-bottom: 16px;
            line-height: 1.6;
        }
        
        .practice-question-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .practice-option {
            padding: 12px 16px;
            background: #FAFAFA;
            border: 2px solid #E0E0E0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        
        .practice-option:hover:not(.answered) {
            background: #F0F0F0;
            border-color: #95A5A6;
        }
        
        .practice-option.selected {
            background: #E3F2FD;
            border-color: #2196F3;
        }
        
        .practice-option.correct {
            background: #E8F5E9;
            border-color: #4CAF50;
        }
        
        .practice-option.incorrect {
            background: #FFEBEE;
            border-color: #F44336;
        }
        
        .practice-option.answered {
            cursor: default;
        }
        
        .practice-option-label {
            font-weight: 500;
            margin-right: 12px;
            min-width: 24px;
        }
        
        .practice-feedback {
            margin-top: 12px;
            padding: 12px;
            border-radius: 6px;
            display: none;
        }
        
        .practice-feedback.show {
            display: block;
        }
        
        .practice-feedback.correct {
            background: #E8F5E9;
            border-left: 4px solid #4CAF50;
        }
        
        .practice-feedback.incorrect {
            background: #FFEBEE;
            border-left: 4px solid #F44336;
        }
        
        .practice-explanation {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(0,0,0,0.1);
            font-size: 0.875rem;
            color: #666666;
        }
        
        .strong-points-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .strong-point-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #F0F9F4;
            border-radius: 6px;
            border: 1px solid #D5F4E6;
        }
        
        .strong-point-name {
            font-weight: 500;
            color: #34495E;
        }
        
        .learning-path {
            margin-top: 16px;
        }
        
        .path-step {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            padding: 16px;
            background: #FAFAFA;
            border-radius: 8px;
            border-left: 4px solid #95A5A6;
        }
        
        .step-number {
            width: 32px;
            height: 32px;
            background: #34495E;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-content h4 {
            margin: 0 0 8px 0;
            color: #34495E;
        }
        
        .step-kp {
            font-size: 0.875rem;
            color: #7F8C8D;
            margin: 4px 0;
        }
        
        .step-desc {
            margin: 8px 0;
            color: #555555;
            line-height: 1.6;
        }
        
        .priority-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-top: 8px;
        }
        
        .priority-é«˜ {
            background: #FADBD8;
            color: #C0392B;
        }
        
        .priority-ä¸­ {
            background: #FCF3CF;
            color: #B7950B;
        }
        
        .practice-questions-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .practice-question-item {
            background: #FAFAFA;
            border-radius: 6px;
            border: 1px solid #E0E0E0;
            overflow: hidden;
        }
        
        .practice-question-item .question-link {
            display: flex;
            flex-direction: column;
            padding: 12px 16px;
            background: transparent;
            color: inherit;
            text-decoration: none;
        }
        
        .practice-question-item .question-link:hover {
            background: #F5F5F5;
        }
        
        .question-id {
            font-weight: 500;
            color: #34495E;
            margin-bottom: 4px;
        }
        
        .question-preview {
            font-size: 0.875rem;
            color: #666666;
            margin: 4px 0;
        }
        
        .question-meta {
            display: flex;
            gap: 12px;
            margin-top: 8px;
            font-size: 0.75rem;
        }
        
        .difficulty-tag,
        .kp-tag {
            padding: 2px 8px;
            background: #E0E0E0;
            border-radius: 4px;
            color: #666666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1 class="result-title">ğŸ‰ æµ‹è¯•å®Œæˆ</h1>
            
            <div id="resultContent">
                <div class="loading">åŠ è½½ç»“æœä¸­...</div>
            </div>
        </div>
    </div>
    
    <script src="js/adaptive.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/test-engine.js"></script>
    <script src="js/questions.js"></script>
    <script>
        // è·å–ä¼šè¯ID
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get('session');
        
        if (!sessionId) {
            window.location.href = 'index.html';
        }
        
        // åˆå§‹åŒ–
        const storage = new TestStorage();
        const engine = new AdaptiveTestEngine(questionsData, storage);
        
        // åŠ è½½ç»“æœ
        function loadResult() {
            const result = storage.loadResult(sessionId);
            
            if (!result) {
                // å¦‚æœæ²¡æœ‰ä¿å­˜çš„ç»“æœï¼Œå°è¯•ä»ä¼šè¯ä¸­ç”Ÿæˆ
                const session = storage.loadSession(sessionId);
                if (session && session.status === 'completed') {
                    // éœ€è¦é‡æ–°è®¡ç®—ç»“æœï¼ˆç®€åŒ–å¤„ç†ï¼‰
                    document.getElementById('resultContent').innerHTML = `
                        <div class="error">ç»“æœæ•°æ®ä¸å®Œæ•´ï¼Œè¯·é‡æ–°æµ‹è¯•</div>
                        <div class="result-actions">
                            <button class="button button-primary" onclick="window.location.href='index.html'">é‡æ–°æµ‹è¯•</button>
                        </div>
                    `;
                    return;
                } else {
                    window.location.href = 'index.html';
                    return;
                }
            }
            
            displayResult(result);
        }
        
        // æ˜¾ç¤ºç»“æœ
        function displayResult(result) {
            const accuracyPercent = (result.correctRate * 100).toFixed(1);
            
            let html = `
                <div class="result-summary">
                    <div class="summary-item">
                        <div class="summary-label">æ€»ä½“èƒ½åŠ›æ°´å¹³</div>
                        <div class="summary-value">${result.abilityLevel}</div>
                        <div class="summary-detail">èƒ½åŠ›å€¼: ${result.ability.toFixed(2)}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">ç­”é¢˜æ­£ç¡®ç‡</div>
                        <div class="summary-value">${accuracyPercent}%</div>
                        <div class="summary-detail">${result.correctCount} / ${result.totalQuestions} é¢˜</div>
                    </div>
                    ${result.difficultyStats ? `
                    <div class="summary-item">
                        <div class="summary-label">å¹³å‡é¢˜ç›®éš¾åº¦</div>
                        <div class="summary-value">${result.difficultyStats.averageDifficulty.toFixed(2)}</div>
                        <div class="summary-detail">${result.difficultyStats.averageDifficulty >= 1 ? 'è¾ƒéš¾' : result.difficultyStats.averageDifficulty >= 0 ? 'ä¸­ç­‰' : 'åŸºç¡€'}</div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            // éš¾åº¦åˆ†å¸ƒ
            if (result.difficultyStats && result.difficultyStats.distribution) {
                html += `
                    <div class="section">
                        <h2>ğŸ“Š é¢˜ç›®éš¾åº¦åˆ†å¸ƒ</h2>
                        <div style="background: #F8F9FA; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #4285F4;">
                            <h3 style="margin-top: 0; color: #1A73E8;">ğŸ’¡ éš¾åº¦è¯´æ˜</h3>
                            <p style="margin: 8px 0; line-height: 1.8; color: #5F6368;">
                                éš¾åº¦å€¼èŒƒå›´æ˜¯ <strong>-3.0 åˆ° 3.0</strong>ï¼Œå…¶ä¸­ï¼š
                            </p>
                            <ul style="margin: 8px 0; padding-left: 24px; line-height: 1.8; color: #5F6368;">
                                <li><strong>è´Ÿæ•°éš¾åº¦</strong>ï¼ˆ-3.0 åˆ° 0.0ï¼‰ï¼šé¢˜ç›®è¾ƒå®¹æ˜“ï¼Œé€‚åˆåŸºç¡€ç»ƒä¹ </li>
                                <li><strong>éš¾åº¦ 0.0</strong>ï¼šä¸­ç­‰éš¾åº¦ï¼Œé€‚åˆå¤§å¤šæ•°å­¦ç”Ÿ</li>
                                <li><strong>æ­£æ•°éš¾åº¦</strong>ï¼ˆ0.0 åˆ° 3.0ï¼‰ï¼šé¢˜ç›®è¾ƒéš¾ï¼Œéœ€è¦è¾ƒå¼ºçš„èƒ½åŠ›</li>
                            </ul>
                            <p style="margin: 8px 0; line-height: 1.8; color: #5F6368;">
                                æœ¬æ¬¡æµ‹è¯•çš„å¹³å‡éš¾åº¦ä¸º <strong>${result.difficultyStats.averageDifficulty.toFixed(2)}</strong>ã€‚
                                ç³»ç»Ÿä¼šæ ¹æ®ä½ çš„ç­”é¢˜æƒ…å†µè‡ªåŠ¨è°ƒæ•´é¢˜ç›®éš¾åº¦ï¼Œéš¾åº¦è¶Šé«˜çš„é¢˜ç›®ç­”å¯¹ï¼Œè¯´æ˜ä½ çš„èƒ½åŠ›æ°´å¹³è¶Šé«˜ã€‚
                            </p>
                            <p style="margin: 8px 0; line-height: 1.8; color: #5F6368;">
                                <strong>ğŸ“ˆ åˆ†æ•°æ„ä¹‰è§£è¯»ï¼š</strong>å¦‚æœä½ åœ¨è¾ƒéš¾æˆ–å›°éš¾é¢˜ç›®ä¸Šç­”å¯¹ç‡é«˜ï¼Œè¯´æ˜ä½ çš„æ•°å­¦èƒ½åŠ›å¾ˆå¼ºï¼›å¦‚æœåœ¨åŸºç¡€é¢˜ä¸Šç­”é”™è¾ƒå¤šï¼Œå»ºè®®åŠ å¼ºåŸºç¡€çŸ¥è¯†çš„å¤ä¹ ã€‚æ­£ç¡®ç‡éœ€è¦ç»“åˆé¢˜ç›®éš¾åº¦æ¥çœ‹ï¼Œç­”å¯¹é«˜éš¾åº¦é¢˜ç›®æ¯”ç­”å¯¹ç®€å•é¢˜ç›®æ›´èƒ½ä½“ç°èƒ½åŠ›æ°´å¹³ã€‚
                            </p>
                        </div>
                        <div class="semester-grid">
                `;
                
                // æŒ‰éš¾åº¦ä»ä½åˆ°é«˜æ’åºæ˜¾ç¤º
                const difficultyOrder = ['éå¸¸ç®€å•', 'åŸºç¡€', 'ä¸­ç­‰', 'è¾ƒéš¾', 'å›°éš¾'];
                for (const rangeName of difficultyOrder) {
                    const stats = result.difficultyStats.distribution[rangeName];
                    if (stats) {
                        const colorMap = {
                            'éå¸¸ç®€å•': '#34A853',
                            'åŸºç¡€': '#66BB6A',
                            'ä¸­ç­‰': '#FFA726',
                            'è¾ƒéš¾': '#FF7043',
                            'å›°éš¾': '#E53935'
                        };
                        const color = colorMap[rangeName] || '#95A5A6';
                        
                        html += `
                            <div class="semester-item" style="border-left-color: ${color};">
                                <div class="semester-name">${stats.label}</div>
                                <div class="semester-progress">
                                    <div class="semester-progress-bar" style="width: ${stats.accuracyPercent}%; background: ${color};"></div>
                                </div>
                                <div class="semester-stats">
                                    <strong>${stats.accuracyPercent}%</strong> æ­£ç¡®ç‡ (${stats.correct}/${stats.total}é¢˜)
                                </div>
                            </div>
                        `;
                    }
                }
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // å­¦æœŸè¡¨ç°
            if (result.semesterStats && Object.keys(result.semesterStats).length > 0) {
                html += `
                    <div class="section">
                        <h2>ğŸ“… å­¦æœŸè¡¨ç°åˆ†æ</h2>
                        <div class="semester-grid">
                `;
                
                for (const [semester, stats] of Object.entries(result.semesterStats)) {
                    html += `
                        <div class="semester-item">
                            <div class="semester-name">${semester}</div>
                            <div class="semester-progress">
                                <div class="semester-progress-bar" style="width: ${stats.accuracyPercent}%"></div>
                            </div>
                            <div class="semester-stats">${stats.accuracyPercent}% (${stats.correct}/${stats.total})</div>
                        </div>
                    `;
                }
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // çŸ¥è¯†ç‚¹æŒæ¡æƒ…å†µ
            if (result.knowledgePointStats && Object.keys(result.knowledgePointStats).length > 0) {
                html += `
                    <div class="section">
                        <h2>ğŸ“š çŸ¥è¯†ç‚¹æŒæ¡æƒ…å†µ</h2>
                        <div class="knowledge-list">
                `;
                
                // æŒ‰æŒæ¡åº¦æ’åº
                const sortedKps = Object.entries(result.knowledgePointStats)
                    .sort((a, b) => a[1].mastery - b[1].mastery);
                
                for (const [kp, stats] of sortedKps) {
                    html += `
                        <div class="knowledge-item">
                            <div class="knowledge-name">${kp}</div>
                            <div class="knowledge-progress">
                                <div class="knowledge-progress-bar" style="width: ${stats.masteryPercent}%"></div>
                            </div>
                            <div class="knowledge-stats">${stats.masteryPercent}% (${stats.correct}/${stats.total})</div>
                        </div>
                    `;
                }
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // å­¦ä¹ å»ºè®®
            if (result.suggestions) {
                html += `
                    <div class="section">
                        <h2>ğŸ’¡ å­¦ä¹ å»ºè®®</h2>
                        <div class="suggestions-content">
                `;
                
                // æ€»ä½“å»ºè®®
                if (result.suggestions.overallAdvice) {
                    html += `
                        <div class="advice-card overall-advice">
                            <div class="advice-icon">ğŸ“‹</div>
                            <div class="advice-content">
                                <h3>æ€»ä½“å»ºè®®</h3>
                                <p>${result.suggestions.overallAdvice}</p>
                            </div>
                        </div>
                    `;
                }
                
                // è–„å¼±çŸ¥è¯†ç‚¹æŒ‡å¯¼
                if (result.suggestions.weakPoints && result.suggestions.weakPoints.length > 0) {
                    html += `
                        <div class="advice-section">
                            <h3 style="margin-top: 24px; margin-bottom: 16px; color: #E74C3C;">âš ï¸ éœ€è¦åŠ å¼ºçš„çŸ¥è¯†ç‚¹</h3>
                    `;
                    
                    for (const weakPoint of result.suggestions.weakPoints) {
                        html += `
                            <div class="advice-card weak-point">
                                <div class="advice-header">
                                    <h4>${weakPoint.knowledgePoint}</h4>
                                    <span class="mastery-badge mastery-low">æŒæ¡åº¦: ${weakPoint.mastery}%</span>
                                </div>
                                <div class="advice-content">
                                    <div class="guidance-focus">
                                        <strong>é‡ç‚¹å†…å®¹ï¼š</strong>
                                        <ul>
                                            ${weakPoint.guidance.focus.map(f => `<li>${f}</li>`).join('')}
                                        </ul>
                                    </div>
                                    <div class="guidance-method">
                                        <strong>å­¦ä¹ æ–¹æ³•ï¼š</strong>
                                        <p>${weakPoint.guidance.method}</p>
                                    </div>
                                    <div class="guidance-tips">
                                        <strong>å­¦ä¹ æç¤ºï¼š</strong>
                                        <ul>
                                            ${weakPoint.guidance.tips.map(t => `<li>${t}</li>`).join('')}
                                        </ul>
                                    </div>
                                    ${weakPoint.practiceQuestionIds.length > 0 ? `
                                        <div class="practice-questions">
                                            <strong>æ¨èç»ƒä¹ ï¼š</strong>
                                            <p>å»ºè®®ç»ƒä¹ ä»¥ä¸‹é¢˜ç›®æ¥å·©å›ºè¯¥çŸ¥è¯†ç‚¹ï¼š</p>
                                            <div class="question-links">
                                                ${weakPoint.practiceQuestionIds.map(id => 
                                                    `<a href="../math-test/é¢˜åº“.html#q${id}" target="_blank" class="question-link">é¢˜ç›® ${id}</a>`
                                                ).join('')}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    }
                    
                    html += `</div>`;
                }
                
                // å¼ºé¡¹çŸ¥è¯†ç‚¹
                if (result.suggestions.strongPoints && result.suggestions.strongPoints.length > 0) {
                    html += `
                        <div class="advice-section">
                            <h3 style="margin-top: 24px; margin-bottom: 16px; color: #27AE60;">âœ… æŒæ¡è‰¯å¥½çš„çŸ¥è¯†ç‚¹</h3>
                            <div class="strong-points-list">
                                ${result.suggestions.strongPoints.map(sp => `
                                    <div class="strong-point-item">
                                        <span class="strong-point-name">${sp.knowledgePoint}</span>
                                        <span class="mastery-badge mastery-high">${sp.mastery}%</span>
                                    </div>
                                `).join('')}
                            </div>
                            <p style="margin-top: 12px; color: #666666; font-size: 0.875rem;">
                                ç»§ç»­ä¿æŒè¿™äº›çŸ¥è¯†ç‚¹çš„ç»ƒä¹ ï¼Œå¯ä»¥é€‚å½“æŒ‘æˆ˜æ›´æœ‰éš¾åº¦çš„é¢˜ç›®ã€‚
                            </p>
                        </div>
                    `;
                }
                
                // å­¦ä¹ è·¯å¾„
                if (result.suggestions.learningPath && result.suggestions.learningPath.length > 0) {
                    html += `
                        <div class="advice-section">
                            <h3 style="margin-top: 24px; margin-bottom: 16px;">ğŸ—ºï¸ å­¦ä¹ è·¯å¾„å»ºè®®</h3>
                            <div class="learning-path">
                                ${result.suggestions.learningPath.map(step => `
                                    <div class="path-step">
                                        <div class="step-number">${step.step}</div>
                                        <div class="step-content">
                                            <h4>${step.action}</h4>
                                            ${step.knowledgePoint ? `<p class="step-kp">çŸ¥è¯†ç‚¹ï¼š${step.knowledgePoint}ï¼ˆæŒæ¡åº¦ï¼š${step.mastery}%ï¼‰</p>` : ''}
                                            <p class="step-desc">${step.description}</p>
                                            ${step.priority ? `<span class="priority-badge priority-${step.priority}">${step.priority}ä¼˜å…ˆçº§</span>` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // æ¨èç»ƒä¹ é¢˜
                if (result.suggestions.practiceQuestions && result.suggestions.practiceQuestions.length > 0) {
                    html += `
                        <div class="advice-section">
                            <h3 style="margin-top: 24px; margin-bottom: 16px;">ğŸ“ é€‚åˆå½“å‰æ°´å¹³çš„ç»ƒä¹ é¢˜</h3>
                            <p style="margin-bottom: 16px; color: #666666;">ä»¥ä¸‹é¢˜ç›®é€‚åˆä½ å½“å‰çš„èƒ½åŠ›æ°´å¹³ï¼Œå¯ä»¥ç›´æ¥åœ¨ä¸‹æ–¹ä½œç­”ï¼š</p>
                            <div class="practice-questions-list">
                                ${result.suggestions.practiceQuestions.map((q, idx) => `
                                    <div class="practice-question-item" data-question-id="${q.id}">
                                        <div class="practice-question-header">
                                            <span class="practice-question-id">ç»ƒä¹ é¢˜ ${idx + 1}</span>
                                            <div class="practice-question-meta">
                                                <span class="difficulty-tag">éš¾åº¦: ${q.difficulty.toFixed(1)}</span>
                                                <span class="kp-tag">${q.knowledgePoints.join(', ')}</span>
                                            </div>
                                        </div>
                                        <div class="practice-question-content">${q.content}</div>
                                        <div class="practice-question-options">
                                            ${q.options.map((opt, optIdx) => `
                                                <div class="practice-option" 
                                                     data-option-index="${optIdx}"
                                                     onclick="selectPracticeOption(${idx}, ${optIdx}, ${q.id})">
                                                    <span class="practice-option-label">${String.fromCharCode(65 + optIdx)}.</span>
                                                    <span class="practice-option-text">${opt}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                        <div class="practice-feedback" id="feedback-${q.id}">
                                            <div id="feedback-content-${q.id}"></div>
                                            ${q.explanation ? `
                                                <div class="practice-explanation">
                                                    <strong>è§£æï¼š</strong>${q.explanation}
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // æ“ä½œæŒ‰é’®
            html += `
                <div class="result-actions">
                    <button class="button button-primary" onclick="window.location.href='index.html'">é‡æ–°æµ‹è¯•</button>
                    <button class="button" onclick="window.location.href='../math-test/é¢˜åº“.html'">å»é¢˜åº“ç»ƒä¹ </button>
                    <button class="button" onclick="window.location.href='../index.html'">è¿”å›é¦–é¡µ</button>
                </div>
            `;
            
            document.getElementById('resultContent').innerHTML = html;
            
            // æ¸²æŸ“æ•°å­¦å…¬å¼ - ç­‰å¾…KaTeXåŠ è½½å®Œæˆ
            function renderMath() {
                if (typeof renderMathInElement !== 'undefined') {
                    const content = document.getElementById('resultContent');
                    if (content) {
                        renderMathInElement(content, {
                            delimiters: [
                                {left: "$$", right: "$$", display: true},
                                {left: "$", right: "$", display: false}
                            ],
                            throwOnError: false
                        });
                    }
                } else {
                    // å¦‚æœKaTeXè¿˜æ²¡åŠ è½½ï¼Œç­‰å¾…ä¸€ä¸‹å†è¯•
                    setTimeout(renderMath, 100);
                }
            }
            
            // ç«‹å³å°è¯•æ¸²æŸ“ï¼Œå¦‚æœKaTeXå·²åŠ è½½
            renderMath();
            
            // ä¹Ÿç­‰å¾…DOMContentLoadedåæ¸²æŸ“ï¼ˆå¦‚æœKaTeXæ˜¯deferåŠ è½½çš„ï¼‰
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', renderMath);
            } else {
                // å¤šæ¬¡å°è¯•æ¸²æŸ“ï¼Œç¡®ä¿KaTeXåŠ è½½åèƒ½æ¸²æŸ“
                setTimeout(renderMath, 200);
                setTimeout(renderMath, 500);
            }
            
            // ç‰¹åˆ«é’ˆå¯¹æ¨èç»ƒä¹ é¢˜åŒºåŸŸè¿›è¡Œæ¸²æŸ“
            setTimeout(() => {
                if (typeof renderMathInElement !== 'undefined') {
                    const practiceList = document.querySelector('.practice-questions-list');
                    if (practiceList) {
                        renderMathInElement(practiceList, {
                            delimiters: [
                                {left: "$$", right: "$$", display: true},
                                {left: "$", right: "$", display: false}
                            ],
                            throwOnError: false
                        });
                    }
                }
            }, 300);
        }
        
        // é€‰æ‹©æ¨èç»ƒä¹ é¢˜çš„é€‰é¡¹
        window.selectPracticeOption = function(questionIndex, optionIndex, questionId) {
            const questionItem = document.querySelector(`[data-question-id="${questionId}"]`);
            if (!questionItem) return;
            
            // æ£€æŸ¥æ˜¯å¦å·²ä½œç­”
            const options = questionItem.querySelectorAll('.practice-option');
            const isAnswered = Array.from(options).some(opt => opt.classList.contains('answered'));
            if (isAnswered) return;
            
            // è·å–é¢˜ç›®æ•°æ®
            const result = JSON.parse(localStorage.getItem('testResult'));
            if (!result || !result.suggestions || !result.suggestions.practiceQuestions) return;
            
            const question = result.suggestions.practiceQuestions[questionIndex];
            if (!question) return;
            
            const isCorrect = optionIndex === question.correctAnswer;
            
            // æ ‡è®°æ‰€æœ‰é€‰é¡¹ä¸ºå·²ç­”
            options.forEach(opt => {
                opt.classList.add('answered');
                opt.onclick = null;
            });
            
            // æ ‡è®°é€‰ä¸­çš„é€‰é¡¹
            const selectedOption = questionItem.querySelector(`[data-option-index="${optionIndex}"]`);
            const correctOption = questionItem.querySelector(`[data-option-index="${question.correctAnswer}"]`);
            
            selectedOption.classList.add('selected');
            
            if (isCorrect) {
                selectedOption.classList.add('correct');
            } else {
                selectedOption.classList.add('incorrect');
                correctOption.classList.add('correct');
            }
            
            // æ˜¾ç¤ºåé¦ˆ
            const feedback = document.getElementById(`feedback-${questionId}`);
            const feedbackContent = document.getElementById(`feedback-content-${questionId}`);
            
            if (isCorrect) {
                feedback.className = 'practice-feedback show correct';
                feedbackContent.innerHTML = '<strong>âœ“ å›ç­”æ­£ç¡®ï¼</strong> ä½ åšå¾—å¾ˆæ£’ï¼';
            } else {
                feedback.className = 'practice-feedback show incorrect';
                feedbackContent.innerHTML = `<strong>âœ— å›ç­”é”™è¯¯ã€‚</strong> æ­£ç¡®ç­”æ¡ˆæ˜¯ <strong>${String.fromCharCode(65 + question.correctAnswer)}</strong>ã€‚`;
            }
            
            // é‡æ–°æ¸²æŸ“æ•°å­¦å…¬å¼ - æ¸²æŸ“æ•´ä¸ªé¢˜ç›®åŒºåŸŸï¼ŒåŒ…æ‹¬é€‰é¡¹
            setTimeout(() => {
                if (typeof renderMathInElement !== 'undefined') {
                    // æ¸²æŸ“æ•´ä¸ªé¢˜ç›®é¡¹ï¼ŒåŒ…æ‹¬é€‰é¡¹å’Œåé¦ˆ
                    renderMathInElement(questionItem, {
                        delimiters: [
                            {left: "$$", right: "$$", display: true},
                            {left: "$", right: "$", display: false}
                        ],
                        throwOnError: false
                    });
                } else {
                    // å¦‚æœKaTeXè¿˜æ²¡åŠ è½½ï¼Œç­‰å¾…ä¸€ä¸‹å†è¯•
                    setTimeout(() => {
                        if (typeof renderMathInElement !== 'undefined') {
                            renderMathInElement(questionItem, {
                                delimiters: [
                                    {left: "$$", right: "$$", display: true},
                                    {left: "$", right: "$", display: false}
                                ],
                                throwOnError: false
                            });
                        }
                    }, 200);
                }
            }, 100);
        };
        
        // é¡µé¢åŠ è½½å®Œæˆåç¡®ä¿æ¸²æŸ“æ•°å­¦å…¬å¼
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (typeof renderMathInElement !== 'undefined') {
                    const content = document.getElementById('resultContent');
                    if (content) {
                        renderMathInElement(content, {
                            delimiters: [
                                {left: "$$", right: "$$", display: true},
                                {left: "$", right: "$", display: false}
                            ],
                            throwOnError: false
                        });
                    }
                }
            }, 300);
        });
        
        // åŠ è½½ç»“æœ
        loadResult();
    </script>
</body>
</html>

